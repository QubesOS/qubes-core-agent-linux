#!/bin/sh

# Source Qubes library.
. /usr/lib/qubes/init/functions

/usr/lib/qubes/qubes-setup-dnat-to-ns

# FIXME: Tinyproxy does not reload DNS servers.
if under_systemd ; then
    systemctl --no-block try-restart qubes-updates-proxy.service
else
    service qubes-updates-proxy try-restart
fi

# Let ntpdate use the ntp servers received by dhcp options:
if [ -z "${DHCP4_NTP_SERVERS}" ]; then
    echo "pool.ntp.org" > /etc/ntp/step-tickers
else
    echo ${DHCP4_NTP_SERVERS} |tr '[[:space:]]' '\n' > /etc/ntp/step-tickers
fi
